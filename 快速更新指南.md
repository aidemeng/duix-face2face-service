# 🚀 Duix Face2Face 快速更新指南

## ⚡ 一键更新
```bash
cd /Users/wanghaoxuan/video_project/duix-face2face-service
./update.sh
```

## 📋 手动更新 (3步骤)

### 1️⃣ 构建推送镜像
```bash
cd /Users/wanghaoxuan/video_project/duix-face2face-service
docker build --platform linux/amd64 --no-cache -t duix-face2face-api .
docker tag duix-face2face-api image.ppinfra.com/prod-eftqrvyctuvyrddswevc/duix-face2face-api:latest
docker push image.ppinfra.com/prod-eftqrvyctuvyrddswevc/duix-face2face-api:latest
```

### 2️⃣ 更新云端服务
在PPIO实例执行：
```bash
docker-compose -f docker-compose.cloud.yml pull
docker-compose -f docker-compose.cloud.yml up -d
```

### 3️⃣ 验证服务
```bash
curl http://localhost:8385/health
```

## 📡 API使用示例

```bash
# 提交任务 (POST)
curl -X POST "http://localhost:8385/api/submit_task" \
  -H "Content-Type: application/json" \
  -d '{"audio_url": "https://example.com/audio.wav", "video_url": "https://example.com/video.mp4"}'

# 查询任务状态 (GET)
curl "http://localhost:8385/api/query_task?task_code=your-task-id"

# 获取结果 (GET)
curl "http://localhost:8385/api/get_result?result_filename=result.mp4&task_code=your-task-id"
```

## 🔍 常用命令

```bash
# 检查服务状态
docker ps
curl http://localhost:8385/health

# 查看日志
docker-compose -f docker-compose.cloud.yml logs -f

# 重启服务
docker-compose -f docker-compose.cloud.yml restart
```

## 🚨 故障排除

| 问题 | 解决方案 |
|------|----------|
| 构建失败 | `docker system prune -f` |
| 服务无响应 | `docker-compose restart` |
| GPU不可用 | `nvidia-smi` |

## 🔗 重要链接

- [PPIO控制台](https://ppio.com/gpu-instance/console)
